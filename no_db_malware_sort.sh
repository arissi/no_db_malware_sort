#!/bin/bash
#
#   malware_sort
#
# DESCRIPTION:
#   Categorize malware into multiple directories based on the first word output from the file command 
#   and then further by separating the code by size.


# root directory where all malware is
mal_dir=$1

# A pretend Python dictionary
declare -a ARRAY=("small:"50001 "medium:"1000001 "large:"6000001 "xlarge:"12000000)

if [ ! -d "$mal_dir" ]; then
	echo "Directory does not exist: $mal_dir"
	echo "Enter root directory where malware is."
	exit 1
fi

for mal_file in $(find $mal_dir); do

	if [ -f $mal_file ]; then
		file_type="$(eval file $mal_file | awk '{ print $2 }')"

		# file command fixes
		case $file_type in
			#  /usr/bin/perl\015 script
			"a") file_type="PerlScript";;
			# very short file  
			"very") file_type="VeryShortFile";;
			# remove empty files
			"empty") rm $mal_file
			continue;;
		*);;
		esac

		# create sub-directories for categorization.
		if [ ! -d $mal_dir$file_type ]; then
			mkdir -p "$mal_dir$file_type"
		fi

		# find out which size category the file fits in.
		filesize=$(stat -c %s $mal_file)
		for category in "${ARRAY[@]}" ; do
			KEY=${category%%:*}
			VALUE=${category#*:}
			if [[ "$filesize" -le $VALUE ]]; then

				if [ ! -d $mal_dir$file_type/$KEY/ ]; then
					mkdir -p "$mal_dir$file_type/$KEY/"
				fi

				mv $mal_file "$mal_dir$file_type/$KEY/"
				break
			fi
		done

fi

done;
